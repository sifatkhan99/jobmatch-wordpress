{"generator":"Code Snippets v3.7.0","date_created":"2025-09-26 10:48","snippets":[{"id":25,"name":"Extend your existing AJAX browse handlers","code":"\/\/ Extend your existing AJAX browse handlers\nadd_filter('jobmatch_browse_query_args', 'jobmatch_apply_advanced_filters', 10, 2);\n\nfunction jobmatch_apply_advanced_filters($args, $filters) {\n    \/\/ Works with your existing WP_Query in the browse functions\n    \n    if (!empty($filters['radius']) && $filters['radius'] !== 'remote') {\n        \/\/ Add to your existing meta_query\n        if (!isset($args['meta_query'])) {\n            $args['meta_query'] = array();\n        }\n        \n        \/\/ This will work with your existing job\/developer queries\n        $user_coords = get_user_meta(get_current_user_id(), 'lat_lng', true);\n        if ($user_coords) {\n            \/\/ Add distance calculation to query\n            add_filter('posts_clauses', function($clauses) use ($user_coords, $filters) {\n                global $wpdb;\n                \n                list($u_lat, $u_lng) = explode(',', $user_coords);\n                $radius = intval($filters['radius']);\n                \n                \/\/ Join with your existing postmeta\n                $clauses['join'] .= \" LEFT JOIN {$wpdb->postmeta} pm_lat ON {$wpdb->posts}.ID = pm_lat.post_id AND pm_lat.meta_key = 'latitude'\";\n                $clauses['join'] .= \" LEFT JOIN {$wpdb->postmeta} pm_lng ON {$wpdb->posts}.ID = pm_lng.post_id AND pm_lng.meta_key = 'longitude'\";\n                \n                \/\/ Add distance calculation\n                $clauses['fields'] .= \", (6371 * acos(cos(radians({$u_lat})) * cos(radians(pm_lat.meta_value)) * cos(radians(pm_lng.meta_value) - radians({$u_lng})) + sin(radians({$u_lat})) * sin(radians(pm_lat.meta_value)))) AS distance\";\n                \n                \/\/ Filter by radius\n                $clauses['where'] .= $wpdb->prepare(\" AND (6371 * acos(cos(radians(%f)) * cos(radians(pm_lat.meta_value)) * cos(radians(pm_lng.meta_value) - radians(%f)) + sin(radians(%f)) * sin(radians(pm_lat.meta_value)))) <= %d\", $u_lat, $u_lng, $u_lat, $radius);\n                \n                return $clauses;\n            }, 10, 2);\n        }\n    }\n    \n    \/\/ Tech stack filter (works with your existing taxonomy)\n    if (!empty($filters['tech_stack'])) {\n        $args['tax_query'][] = array(\n            'taxonomy' => 'tech_stack',\n            'field' => 'term_id',\n            'terms' => $filters['tech_stack']\n        );\n    }\n    \n    \/\/ Salary filter\n    if (!empty($filters['salary_min']) || !empty($filters['salary_max'])) {\n        $salary_query = array('relation' => 'AND');\n        \n        if (!empty($filters['salary_min'])) {\n            $salary_query[] = array(\n                'key' => 'salary_expectation',\n                'value' => $filters['salary_min'],\n                'compare' => '>=',\n                'type' => 'NUMERIC'\n            );\n        }\n        \n        if (!empty($filters['salary_max'])) {\n            $salary_query[] = array(\n                'key' => 'salary_expectation',\n                'value' => $filters['salary_max'],\n                'compare' => '<=',\n                'type' => 'NUMERIC'\n            );\n        }\n        \n        $args['meta_query'][] = $salary_query;\n    }\n    \n    return $args;\n}\n\n\/\/ Modify your existing browse AJAX handlers\nadd_action('wp_ajax_jobmatch_filter_browse', 'jobmatch_handle_filtered_browse');\nadd_action('wp_ajax_nopriv_jobmatch_filter_browse', 'jobmatch_handle_filtered_browse');\n\nfunction jobmatch_handle_filtered_browse() {\n    \/\/ This works with your existing nonce verification\n    check_ajax_referer('jobmatch_nonce', 'nonce');\n    \n    $filters = $_POST['filters'] ?? array();\n    $user_role = get_user_meta(get_current_user_id(), 'user_role', true);\n    \n    \/\/ Use your existing browse functions with filter modifications\n    $args = array(\n        'post_type' => $user_role === 'developer' ? 'jobs' : 'users',\n        'posts_per_page' => 20\n    );\n    \n    \/\/ Apply the filters\n    $args = apply_filters('jobmatch_browse_query_args', $args, $filters);\n    \n    \/\/ Render using your existing template functions\n    ob_start();\n    if ($user_role === 'developer') {\n        \/\/ Use your existing job card rendering\n        $jobs = get_posts($args);\n        foreach ($jobs as $job) {\n            echo jobmatch_render_job_card($job->ID); \/\/ Your existing function\n        }\n    } else {\n        \/\/ Use your existing developer card rendering\n        $developers = get_users($args);\n        foreach ($developers as $dev) {\n            echo jobmatch_render_developer_card($dev->ID); \/\/ Your existing function\n        }\n    }\n    \n    wp_send_json_success(array('html' => ob_get_clean()));\n}","active":true,"modified":"2025-09-24 19:47:57","revision":"1"}]}