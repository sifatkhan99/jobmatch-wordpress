{"generator":"Code Snippets v3.7.0","date_created":"2025-09-26 10:48","snippets":[{"id":22,"name":"Advanced Filtering and Geocoding System (Complete Rewrite)","code":"\n\/**\n * Admin Dashboard & Settings Management\n * Add this to Code Snippets plugin\n *\/\n\n\/\/ Add admin menu pages\nadd_action('admin_menu', 'jobmatch_add_admin_pages');\n\nfunction jobmatch_add_admin_pages() {\n    \/\/ Main menu page\n    add_menu_page(\n        'JobMatch Settings',\n        'JobMatch',\n        'manage_options',\n        'jobmatch-admin',\n        'jobmatch_admin_dashboard',\n        'dashicons-businesswoman',\n        30\n    );\n    \n    \/\/ Submenu pages\n    add_submenu_page(\n        'jobmatch-admin',\n        'Dashboard',\n        'Dashboard',\n        'manage_options',\n        'jobmatch-admin',\n        'jobmatch_admin_dashboard'\n    );\n    \n    add_submenu_page(\n        'jobmatch-admin',\n        'Matchmaking Settings',\n        'Matchmaking',\n        'manage_options',\n        'jobmatch-matching',\n        'jobmatch_matching_settings'\n    );\n    \n    add_submenu_page(\n        'jobmatch-admin',\n        'Credit Packages',\n        'Credit Packages',\n        'manage_options',\n        'jobmatch-credits',\n        'jobmatch_credit_settings'\n    );\n    \n    add_submenu_page(\n        'jobmatch-admin',\n        'Analytics',\n        'Analytics',\n        'manage_options',\n        'jobmatch-analytics',\n        'jobmatch_analytics_page'\n    );\n    \n    add_submenu_page(\n        'jobmatch-admin',\n        'User Management',\n        'Users',\n        'manage_options',\n        'jobmatch-users',\n        'jobmatch_user_management'\n    );\n}\n\n\/\/ Main admin dashboard\nfunction jobmatch_admin_dashboard() {\n    \/\/ Get platform statistics\n    $stats = jobmatch_get_platform_stats();\n    \n    ?>\n    <div class=\"wrap\">\n        <h1>JobMatch Admin Dashboard<\/h1>\n        \n        <div class=\"jobmatch-admin-grid\">\n            <!-- Overview Stats -->\n            <div class=\"card\">\n                <h2>Platform Overview<\/h2>\n                <div class=\"stats-grid\">\n                    <div class=\"stat-item\">\n                        <div class=\"stat-number\"><?php echo $stats['total_users']; ?><\/div>\n                        <div class=\"stat-label\">Total Users<\/div>\n                    <\/div>\n                    <div class=\"stat-item\">\n                        <div class=\"stat-number\"><?php echo $stats['active_jobs']; ?><\/div>\n                        <div class=\"stat-label\">Active Jobs<\/div>\n                    <\/div>\n                    <div class=\"stat-item\">\n                        <div class=\"stat-number\"><?php echo $stats['total_matches']; ?><\/div>\n                        <div class=\"stat-label\">Total Matches<\/div>\n                    <\/div>\n                    <div class=\"stat-item\">\n                        <div class=\"stat-number\"><?php echo $stats['revenue']; ?>\u20ac<\/div>\n                        <div class=\"stat-label\">Total Revenue<\/div>\n                    <\/div>\n                <\/div>\n            <\/div>\n            \n            <!-- User Growth -->\n            <div class=\"card\">\n                <h2>User Growth (30 Days)<\/h2>\n                <canvas id=\"userGrowthChart\" width=\"400\" height=\"200\"><\/canvas>\n            <\/div>\n            \n            <!-- Match Activity -->\n            <div class=\"card\">\n                <h2>Match Activity<\/h2>\n                <div class=\"match-stats\">\n                    <p><strong>Mutual Matches:<\/strong> <?php echo $stats['mutual_matches']; ?><\/p>\n                    <p><strong>Success Rate:<\/strong> <?php echo $stats['success_rate']; ?>%<\/p>\n                    <p><strong>Avg Time to Match:<\/strong> <?php echo $stats['avg_time_to_match']; ?> days<\/p>\n                <\/div>\n            <\/div>\n            \n            <!-- Recent Activity -->\n            <div class=\"card\">\n                <h2>Recent Activity<\/h2>\n                <div class=\"activity-feed\">\n                    <?php echo jobmatch_get_recent_activity(); ?>\n                <\/div>\n            <\/div>\n            \n            <!-- System Health -->\n            <div class=\"card\">\n                <h2>System Health<\/h2>\n                <div class=\"health-checks\">\n                    <?php echo jobmatch_system_health_checks(); ?>\n                <\/div>\n            <\/div>\n            \n            <!-- Quick Actions -->\n            <div class=\"card\">\n                <h2>Quick Actions<\/h2>\n                <div class=\"quick-actions\">\n                    <a href=\"?page=jobmatch-matching\" class=\"button button-primary\">Configure Matching<\/a>\n                    <a href=\"?page=jobmatch-credits\" class=\"button button-secondary\">Manage Credits<\/a>\n                    <button onclick=\"jobmatchRecalculateScores()\" class=\"button\">Recalculate All Scores<\/button>\n                    <button onclick=\"jobmatchCleanupOldData()\" class=\"button\">Cleanup Old Data<\/button>\n                <\/div>\n            <\/div>\n        <\/div>\n    <\/div>\n    \n    <?php jobmatch_admin_dashboard_scripts(); ?>\n    <?php\n}\n\n\/\/ Matchmaking settings page\nfunction jobmatch_matching_settings() {\n    if (isset($_POST['submit'])) {\n        jobmatch_update_matching_settings($_POST);\n        echo '<div class=\"notice notice-success\"><p>Settings updated!<\/p><\/div>';\n    }\n    \n    $weights = jobmatch_get_matchmaking_weights();\n    $culture_questions = jobmatch_get_culture_questions();\n    \n    ?>\n    <div class=\"wrap\">\n        <h1>Matchmaking Configuration<\/h1>\n        \n        <form method=\"post\">\n            <?php wp_nonce_field('jobmatch_matching_settings'); ?>\n            \n            <div class=\"jobmatch-settings-grid\">\n                <!-- Matching Weights -->\n                <div class=\"card\">\n                    <h2>Matching Algorithm Weights<\/h2>\n                    <p>Configure how different factors influence match scores. Total must equal 100%.<\/p>\n                    \n                    <table class=\"form-table\">\n                        <tr>\n                            <th>Skills Match<\/th>\n                            <td>\n                                <input type=\"range\" name=\"weights[skills_match]\" value=\"<?php echo $weights['skills_match']; ?>\" min=\"0\" max=\"100\" class=\"weight-slider\" data-target=\"skills-display\">\n                                <span id=\"skills-display\"><?php echo $weights['skills_match']; ?>%<\/span>\n                                <p class=\"description\">Weight for technical skills overlap<\/p>\n                            <\/td>\n                        <\/tr>\n                        <tr>\n                            <th>Salary Alignment<\/th>\n                            <td>\n                                <input type=\"range\" name=\"weights[salary_alignment]\" value=\"<?php echo $weights['salary_alignment']; ?>\" min=\"0\" max=\"100\" class=\"weight-slider\" data-target=\"salary-display\">\n                                <span id=\"salary-display\"><?php echo $weights['salary_alignment']; ?>%<\/span>\n                                <p class=\"description\">Weight for salary expectation match<\/p>\n                            <\/td>\n                        <\/tr>\n                        <tr>\n                            <th>Location Proximity<\/th>\n                            <td>\n                                <input type=\"range\" name=\"weights[location_proximity]\" value=\"<?php echo $weights['location_proximity']; ?>\" min=\"0\" max=\"100\" class=\"weight-slider\" data-target=\"location-display\">\n                                <span id=\"location-display\"><?php echo $weights['location_proximity']; ?>%<\/span>\n                                <p class=\"description\">Weight for geographic proximity<\/p>\n                            <\/td>\n                        <\/tr>\n                        <tr>\n                            <th>Culture Fit<\/th>\n                            <td>\n                                <input type=\"range\" name=\"weights[culture_fit]\" value=\"<?php echo $weights['culture_fit']; ?>\" min=\"0\" max=\"100\" class=\"weight-slider\" data-target=\"culture-display\">\n                                <span id=\"culture-display\"><?php echo $weights['culture_fit']; ?>%<\/span>\n                                <p class=\"description\">Weight for culture alignment<\/p>\n                            <\/td>\n                        <\/tr>\n                        <tr>\n                            <th>Experience Level<\/th>\n                            <td>\n                                <input type=\"range\" name=\"weights[experience_level]\" value=\"<?php echo $weights['experience_level']; ?>\" min=\"0\" max=\"100\" class=\"weight-slider\" data-target=\"experience-display\">\n                                <span id=\"experience-display\"><?php echo $weights['experience_level']; ?>%<\/span>\n                                <p class=\"description\">Weight for experience level match<\/p>\n                            <\/td>\n                        <\/tr>\n                    <\/table>\n                    \n                    <div class=\"weight-total\">\n                        Total: <span id=\"total-weight\"><?php echo array_sum($weights); ?><\/span>%\n                        <span id=\"weight-warning\" style=\"color: red; display: none;\">Must equal 100%<\/span>\n                    <\/div>\n                <\/div>\n                \n                <!-- Algorithm Settings -->\n                <div class=\"card\">\n                    <h2>Algorithm Parameters<\/h2>\n                    \n                    <table class=\"form-table\">\n                        <tr>\n                            <th>Minimum Match Score<\/th>\n                            <td>\n                                <input type=\"number\" name=\"min_match_score\" value=\"<?php echo get_option('jobmatch_min_score', 50); ?>\" min=\"0\" max=\"100\">%\n                                <p class=\"description\">Hide matches below this score<\/p>\n                            <\/td>\n                        <\/tr>\n                        <tr>\n                            <th>High Match Threshold<\/th>\n                            <td>\n                                <input type=\"number\" name=\"high_match_threshold\" value=\"<?php echo get_option('jobmatch_high_threshold', 80); ?>\" min=\"0\" max=\"100\">%\n                                <p class=\"description\">Send notifications for matches above this score<\/p>\n                            <\/td>\n                        <\/tr>\n                        <tr>\n                            <th>Score Calculation Frequency<\/th>\n                            <td>\n                                <select name=\"score_frequency\">\n                                    <option value=\"daily\" <?php selected(get_option('jobmatch_score_frequency', 'daily'), 'daily'); ?>>Daily<\/option>\n                                    <option value=\"weekly\" <?php selected(get_option('jobmatch_score_frequency'), 'weekly'); ?>>Weekly<\/option>\n                                    <option value=\"manual\" <?php selected(get_option('jobmatch_score_frequency'), 'manual'); ?>>Manual Only<\/option>\n                                <\/select>\n                            <\/td>\n                        <\/tr>\n                    <\/table>\n                <\/div>\n                \n                <!-- Testing Tools -->\n                <div class=\"card\">\n                    <h2>Testing & Validation<\/h2>\n                    \n                    <div class=\"test-match-section\">\n                        <h3>Test Match Score<\/h3>\n                        <select id=\"test-developer\">\n                            <option value=\"\">Select Developer<\/option>\n                            <?php\n                            $developers = get_users(array('meta_key' => 'user_role', 'meta_value' => 'developer'));\n                            foreach ($developers as $dev) {\n                                echo '<option value=\"' . $dev->ID . '\">' . $dev->display_name . '<\/option>';\n                            }\n                            ?>\n                        <\/select>\n                        \n                        <select id=\"test-job\">\n                            <option value=\"\">Select Job<\/option>\n                            <?php\n                            $jobs = get_posts(array('post_type' => 'jobs', 'numberposts' => -1));\n                            foreach ($jobs as $job) {\n                                echo '<option value=\"' . $job->ID . '\">' . $job->post_title . '<\/option>';\n                            }\n                            ?>\n                        <\/select>\n                        \n                        <button type=\"button\" onclick=\"testMatchScore()\" class=\"button\">Calculate Test Score<\/button>\n                        <div id=\"test-results\"><\/div>\n                    <\/div>\n                <\/div>\n            <\/div>\n            \n            <?php submit_button('Save Matching Settings'); ?>\n        <\/form>\n    <\/div>\n    \n    <?php jobmatch_matching_settings_scripts(); ?>\n    <?php\n}\n\n\/\/ Credit packages settings\nfunction jobmatch_credit_settings() {\n    if (isset($_POST['submit'])) {\n        jobmatch_update_credit_packages($_POST);\n        echo '<div class=\"notice notice-success\"><p>Credit packages updated!<\/p><\/div>';\n    }\n    \n    $packages = jobmatch_get_credit_packages();\n    \n    ?>\n    <div class=\"wrap\">\n        <h1>Credit Package Management<\/h1>\n        \n        <form method=\"post\">\n            <?php wp_nonce_field('jobmatch_credit_settings'); ?>\n            \n            <div class=\"credit-packages-grid\">\n                <?php foreach ($packages as $package_id => $package): ?>\n                <div class=\"card package-card\">\n                    <h3><?php echo $package['name']; ?><\/h3>\n                    \n                    <table class=\"form-table\">\n                        <tr>\n                            <th>Package Name<\/th>\n                            <td><input type=\"text\" name=\"packages[<?php echo $package_id; ?>][name]\" value=\"<?php echo $package['name']; ?>\"><\/td>\n                        <\/tr>\n                        <tr>\n                            <th>Credits<\/th>\n                            <td><input type=\"number\" name=\"packages[<?php echo $package_id; ?>][credits]\" value=\"<?php echo $package['credits']; ?>\"><\/td>\n                        <\/tr>\n                        <tr>\n                            <th>Price (\u20ac)<\/th>\n                            <td><input type=\"number\" name=\"packages[<?php echo $package_id; ?>][price]\" value=\"<?php echo $package['price']; ?>\" step=\"0.01\"><\/td>\n                        <\/tr>\n                        <tr>\n                            <th>Popular<\/th>\n                            <td><input type=\"checkbox\" name=\"packages[<?php echo $package_id; ?>][popular]\" <?php checked($package['popular']); ?>><\/td>\n                        <\/tr>\n                        <tr>\n                            <th>Description<\/th>\n                            <td><textarea name=\"packages[<?php echo $package_id; ?>][description]\"><?php echo $package['description']; ?><\/textarea><\/td>\n                        <\/tr>\n                    <\/table>\n                    \n                    <div class=\"package-stats\">\n                        <p><strong>Total Sales:<\/strong> <?php echo jobmatch_get_package_sales($package_id); ?><\/p>\n                        <p><strong>Revenue:<\/strong> \u20ac<?php echo jobmatch_get_package_revenue($package_id); ?><\/p>\n                    <\/div>\n                <\/div>\n                <?php endforeach; ?>\n            <\/div>\n            \n            <!-- Credit Settings -->\n            <div class=\"card\">\n                <h2>Credit System Settings<\/h2>\n                \n                <table class=\"form-table\">\n                    <tr>\n                        <th>Initial Credits for New Companies<\/th>\n                        <td>\n                            <input type=\"number\" name=\"initial_credits\" value=\"<?php echo get_option('jobmatch_initial_credits', 25); ?>\" min=\"0\">\n                            <p class=\"description\">Free credits given to new company accounts<\/p>\n                        <\/td>\n                    <\/tr>\n                    <tr>\n                        <th>Low Credit Warning Threshold<\/th>\n                        <td>\n                            <input type=\"number\" name=\"low_credit_threshold\" value=\"<?php echo get_option('jobmatch_low_credit_threshold', 5); ?>\" min=\"0\">\n                            <p class=\"description\">Send warning when credits fall below this number<\/p>\n                        <\/td>\n                    <\/tr>\n                    <tr>\n                        <th>Credit Cost Per Match Reveal<\/th>\n                        <td>\n                            <input type=\"number\" name=\"credit_cost_per_reveal\" value=\"<?php echo get_option('jobmatch_credit_cost', 1); ?>\" min=\"1\">\n                            <p class=\"description\">Credits deducted when company gets a mutual match<\/p>\n                        <\/td>\n                    <\/tr>\n                <\/table>\n            <\/div>\n            \n            <?php submit_button('Save Credit Settings'); ?>\n        <\/form>\n    <\/div>\n    <?php\n}\n\n\/\/ Analytics page\nfunction jobmatch_analytics_page() {\n    $analytics = jobmatch_get_analytics_data();\n    \n    ?>\n    <div class=\"wrap\">\n        <h1>JobMatch Analytics<\/h1>\n        \n        <div class=\"analytics-grid\">\n            <!-- Match Success Metrics -->\n            <div class=\"card\">\n                <h2>Match Success Metrics<\/h2>\n                <canvas id=\"matchSuccessChart\" width=\"400\" height=\"200\"><\/canvas>\n                \n                <div class=\"metrics-summary\">\n                    <p><strong>Total Matches:<\/strong> <?php echo $analytics['total_matches']; ?><\/p>\n                    <p><strong>Mutual Match Rate:<\/strong> <?php echo $analytics['mutual_rate']; ?>%<\/p>\n                    <p><strong>Chat Conversion Rate:<\/strong> <?php echo $analytics['chat_rate']; ?>%<\/p>\n                <\/div>\n            <\/div>\n            \n            <!-- Revenue Analytics -->\n            <div class=\"card\">\n                <h2>Revenue Analytics<\/h2>\n                <canvas id=\"revenueChart\" width=\"400\" height=\"200\"><\/canvas>\n                \n                <div class=\"revenue-summary\">\n                    <p><strong>Total Revenue:<\/strong> \u20ac<?php echo $analytics['total_revenue']; ?><\/p>\n                    <p><strong>Monthly Recurring:<\/strong> \u20ac<?php echo $analytics['monthly_revenue']; ?><\/p>\n                    <p><strong>Average Order Value:<\/strong> \u20ac<?php echo $analytics['avg_order_value']; ?><\/p>\n                <\/div>\n            <\/div>\n            \n            <!-- User Engagement -->\n            <div class=\"card\">\n                <h2>User Engagement<\/h2>\n                <div class=\"engagement-stats\">\n                    <div class=\"stat-row\">\n                        <span>Daily Active Users:<\/span>\n                        <span><?php echo $analytics['daily_active']; ?><\/span>\n                    <\/div>\n                    <div class=\"stat-row\">\n                        <span>Weekly Active Users:<\/span>\n                        <span><?php echo $analytics['weekly_active']; ?><\/span>\n                    <\/div>\n                    <div class=\"stat-row\">\n                        <span>Average Session Duration:<\/span>\n                        <span><?php echo $analytics['avg_session']; ?> minutes<\/span>\n                    <\/div>\n                    <div class=\"stat-row\">\n                        <span>Page Views per Session:<\/span>\n                        <span><?php echo $analytics['pages_per_session']; ?><\/span>\n                    <\/div>\n                <\/div>\n            <\/div>\n            \n            <!-- Top Performing Content -->\n            <div class=\"card\">\n                <h2>Top Performing Jobs<\/h2>\n                <table class=\"wp-list-table widefat fixed striped\">\n                    <thead>\n                        <tr>\n                            <th>Job Title<\/th>\n                            <th>Views<\/th>\n                            <th>Applications<\/th>\n                            <th>Conversion Rate<\/th>\n                        <\/tr>\n                    <\/thead>\n                    <tbody>\n                        <?php foreach ($analytics['top_jobs'] as $job): ?>\n                        <tr>\n                            <td><?php echo $job['title']; ?><\/td>\n                            <td><?php echo $job['views']; ?><\/td>\n                            <td><?php echo $job['applications']; ?><\/td>\n                            <td><?php echo $job['conversion']; ?>%<\/td>\n                        <\/tr>\n                        <?php endforeach; ?>\n                    <\/tbody>\n                <\/table>\n            <\/div>\n        <\/div>\n    <\/div>\n    \n    <?php jobmatch_analytics_scripts(); ?>\n    <?php\n}\n\n\/\/ User management page\nfunction jobmatch_user_management() {\n    $filter = $_GET['filter'] ?? 'all';\n    $users = jobmatch_get_filtered_users($filter);\n    \n    ?>\n    <div class=\"wrap\">\n        <h1>User Management<\/h1>\n        \n        <div class=\"tablenav top\">\n            <div class=\"alignleft actions\">\n                <select name=\"filter\" onchange=\"filterUsers(this.value)\">\n                    <option value=\"all\" <?php selected($filter, 'all'); ?>>All Users<\/option>\n                    <option value=\"developers\" <?php selected($filter, 'developers'); ?>>Developers<\/option>\n                    <option value=\"companies\" <?php selected($filter, 'companies'); ?>>Companies<\/option>\n                    <option value=\"active\" <?php selected($filter, 'active'); ?>>Active (7 days)<\/option>\n                    <option value=\"inactive\" <?php selected($filter, 'inactive'); ?>>Inactive (30+ days)<\/option>\n                <\/select>\n            <\/div>\n            \n            <div class=\"alignright actions\">\n                <button onclick=\"exportUsers()\" class=\"button\">Export CSV<\/button>\n                <button onclick=\"bulkMessage()\" class=\"button\">Send Bulk Message<\/button>\n            <\/div>\n        <\/div>\n        \n        <table class=\"wp-list-table widefat fixed striped\">\n            <thead>\n                <tr>\n                    <th><input type=\"checkbox\" id=\"select-all\"><\/th>\n                    <th>User<\/th>\n                    <th>Role<\/th>\n                    <th>Joined<\/th>\n                    <th>Last Active<\/th>\n                    <th>Matches<\/th>\n                    <th>Status<\/th>\n                    <th>Actions<\/th>\n                <\/tr>\n            <\/thead>\n            <tbody>\n                <?php foreach ($users as $user): ?>\n                <tr>\n                    <td><input type=\"checkbox\" name=\"user_ids[]\" value=\"<?php echo $user->ID; ?>\"><\/td>\n                    <td>\n                        <strong><?php echo $user->display_name; ?><\/strong><br>\n                        <small><?php echo $user->user_email; ?><\/small>\n                    <\/td>\n                    <td><?php echo ucfirst(get_user_meta($user->ID, 'user_role', true)); ?><\/td>\n                    <td><?php echo date('M j, Y', strtotime($user->user_registered)); ?><\/td>\n                    <td>\n                        <?php \n                        $last_login = get_user_meta($user->ID, 'last_login', true);\n                        echo $last_login ? human_time_diff(strtotime($last_login)) . ' ago' : 'Never';\n                        ?>\n                    <\/td>\n                    <td><?php echo jobmatch_get_user_match_count($user->ID); ?><\/td>\n                    <td>\n                        <?php \n                        $onboarding = get_user_meta($user->ID, 'onboarding_complete', true);\n                        echo $onboarding ? '<span style=\"color: green;\">Active<\/span>' : '<span style=\"color: orange;\">Incomplete<\/span>';\n                        ?>\n                    <\/td>\n                    <td>\n                        <a href=\"user-edit.php?user_id=<?php echo $user->ID; ?>\" class=\"button button-small\">Edit<\/a>\n                        <button onclick=\"sendUserMessage(<?php echo $user->ID; ?>)\" class=\"button button-small\">Message<\/button>\n                        <button onclick=\"viewUserAnalytics(<?php echo $user->ID; ?>)\" class=\"button button-small\">Analytics<\/button>\n                    <\/td>\n                <\/tr>\n                <?php endforeach; ?>\n            <\/tbody>\n        <\/table>\n    <\/div>\n    \n    <?php jobmatch_user_management_scripts(); ?>\n    <?php\n}\n\n\/\/ Helper functions for admin functionality\nfunction jobmatch_get_platform_stats() {\n    global $wpdb;\n    \n    $stats = array();\n    \n    \/\/ Total users by role\n    $stats['total_users'] = $wpdb->get_var(\"SELECT COUNT(*) FROM {$wpdb->users}\");\n    $stats['developers'] = $wpdb->get_var(\"SELECT COUNT(*) FROM {$wpdb->usermeta} WHERE meta_key = 'user_role' AND meta_value = 'developer'\");\n    $stats['companies'] = $wpdb->get_var(\"SELECT COUNT(*) FROM {$wpdb->usermeta} WHERE meta_key = 'user_role' AND meta_value = 'company'\");\n    \n    \/\/ Active jobs\n    $stats['active_jobs'] = wp_count_posts('jobs')->publish;\n    \n    \/\/ Match statistics\n    $matches_table = $wpdb->prefix . 'match_scores';\n    $stats['total_matches'] = $wpdb->get_var(\"SELECT COUNT(*) FROM {$wpdb->posts} WHERE post_type = 'matches'\");\n    $stats['mutual_matches'] = $wpdb->get_var(\"SELECT COUNT(*) FROM {$wpdb->posts} p JOIN {$wpdb->postmeta} pm ON p.ID = pm.post_id WHERE p.post_type = 'matches' AND pm.meta_key = 'match_status' AND pm.meta_value IN ('mutual', 'revealed', 'chatting')\");\n    \n    \/\/ Revenue\n    $transactions_table = $wpdb->prefix . 'credit_transactions';\n    $stats['revenue'] = $wpdb->get_var(\"SELECT SUM(amount * 2.5) FROM $transactions_table WHERE transaction_type = 'purchase'\") ?: 0;\n    \n    \/\/ Success rate\n    $stats['success_rate'] = $stats['total_matches'] > 0 ? round(($stats['mutual_matches'] \/ $stats['total_matches']) * 100, 1) : 0;\n    \n    \/\/ Average time to match (placeholder)\n    $stats['avg_time_to_match'] = 3.5;\n    \n    return $stats;\n}\n\nfunction jobmatch_update_matching_settings($data) {\n    if (!wp_verify_nonce($data['_wpnonce'], 'jobmatch_matching_settings')) {\n        return;\n    }\n    \n    \/\/ Update weights\n    if (isset($data['weights'])) {\n        $weights = array_map('intval', $data['weights']);\n        \/\/ Ensure they add up to 100\n        $total = array_sum($weights);\n        if ($total != 100) {\n            foreach ($weights as $key => $value) {\n                $weights[$key] = round(($value \/ $total) * 100, 1);\n            }\n        }\n        update_option('jobmatch_weights', $weights);\n    }\n    \n    \/\/ Update other settings\n    update_option('jobmatch_min_score', intval($data['min_match_score']));\n    update_option('jobmatch_high_threshold', intval($data['high_match_threshold']));\n    update_option('jobmatch_score_frequency', sanitize_text_field($data['score_frequency']));\n}\n\n\/\/ JavaScript for admin pages\nfunction jobmatch_admin_dashboard_scripts() {\n    ?>\n    <script>\n    function jobmatchRecalculateScores() {\n        if (confirm('This will recalculate all match scores. This may take several minutes. Continue?')) {\n            jQuery.post(ajaxurl, {\n                action: 'jobmatch_recalculate_all_scores',\n                nonce: '<?php echo wp_create_nonce('jobmatch_admin'); ?>'\n            }, function(response) {\n                if (response.success) {\n                    alert('Score recalculation started. This will run in the background.');\n                }\n            });\n        }\n    }\n    \n    function jobmatchCleanupOldData() {\n        if (confirm('This will delete old notifications and expired data. Continue?')) {\n            jQuery.post(ajaxurl, {\n                action: 'jobmatch_cleanup_data',\n                nonce: '<?php echo wp_create_nonce('jobmatch_admin'); ?>'\n            }, function(response) {\n                if (response.success) {\n                    alert('Data cleanup completed.');\n                    location.reload();\n                }\n            });\n        }\n    }\n    <\/script>\n    \n    <style>\n    .jobmatch-admin-grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));\n        gap: 20px;\n        margin-top: 20px;\n    }\n    \n    .card {\n        background: white;\n        border: 1px solid #ccd0d4;\n        border-radius: 4px;\n        padding: 20px;\n    }\n    \n    .stats-grid {\n        display: grid;\n        grid-template-columns: repeat(2, 1fr);\n        gap: 15px;\n    }\n    \n    .stat-item {\n        text-align: center;\n        padding: 15px;\n        background: #f9f9f9;\n        border-radius: 4px;\n    }\n    \n    .stat-number {\n        font-size: 2rem;\n        font-weight: bold;\n        color: #0073aa;\n    }\n    \n    .stat-label {\n        font-size: 0.9rem;\n        color: #666;\n        margin-top: 5px;\n    }\n    \n    .quick-actions {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 10px;\n    }\n    \n    .health-checks .health-item {\n        display: flex;\n        justify-content: space-between;\n        padding: 8px 0;\n        border-bottom: 1px solid #eee;\n    }\n    \n    .health-status.good { color: #46b450; }\n    .health-status.warning { color: #ffb900; }\n    .health-status.error { color: #dc3232; }\n    <\/style>\n    <?php\n}\n\nfunction jobmatch_matching_settings_scripts() {\n    ?>\n    <script>\n    jQuery(document).ready(function($) {\n        \/\/ Weight slider updates\n        $('.weight-slider').on('input', function() {\n            const target = $(this).data('target');\n            $('#' + target).text($(this).val() + '%');\n            updateTotalWeight();\n        });\n        \n        function updateTotalWeight() {\n            let total = 0;\n            $('.weight-slider').each(function() {\n                total += parseInt($(this).val());\n            });\n            $('#total-weight').text(total);\n            \n            if (total !== 100) {\n                $('#weight-warning').show();\n                $('#submit').prop('disabled', true);\n            } else {\n                $('#weight-warning').hide();\n                $('#submit').prop('disabled', false);\n            }\n        }\n    });\n    \n    function testMatchScore() {\n        const devId = $('#test-developer').val();\n        const jobId = $('#test-job').val();\n        \n        if (!devId || !jobId) {\n            alert('Please select both a developer and a job');\n            return;\n        }\n        \n        jQuery.post(ajaxurl, {\n            action: 'jobmatch_test_score',\n            developer_id: devId,\n            job_id: jobId,\n            nonce: '<?php echo wp_create_nonce('jobmatch_admin'); ?>'\n        }, function(response) {\n            if (response.success) {\n                $('#test-results').html(`\n                    <h4>Test Results:<\/h4>\n                    <p><strong>Overall Score:<\/strong> ${response.data.score}%<\/p>\n                    <div class=\"factor-breakdown\">\n                        ${Object.entries(response.data.factors).map(([factor, score]) => \n                            `<p>${factor}: ${score.toFixed(1)}%<\/p>`\n                        ).join('')}\n                    <\/div>\n                `);\n            }\n        });\n    }\n    <\/script>\n    \n    <style>\n    .jobmatch-settings-grid {\n        display: grid;\n        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));\n        gap: 20px;\n        margin-top: 20px;\n    }\n    \n    .weight-slider {\n        width: 200px;\n        margin-right: 10px;\n    }\n    \n    .weight-total {\n        font-size: 1.2rem;\n        font-weight: bold;\n        margin-top: 15px;\n        padding: 10px;\n        background: #f0f0f1;\n        border-radius: 4px;\n    }\n    \n    .test-match-section select {\n        margin-right: 10px;\n        margin-bottom: 10px;\n    }\n    \n    #test-results {\n        margin-top: 15px;\n        padding: 15px;\n        background: #f9f9f9;\n        border-radius: 4px;\n    }\n    <\/style>\n    <?php\n}\n\n\/\/ AJAX handlers for admin functionality\nadd_action('wp_ajax_jobmatch_recalculate_all_scores', 'jobmatch_ajax_recalculate_scores');\nfunction jobmatch_ajax_recalculate_scores() {\n    check_ajax_referer('jobmatch_admin', 'nonce');\n    \n    if (!current_user_can('manage_options')) {\n        wp_send_json_error('Insufficient permissions');\n    }\n    \n    \/\/ Schedule background recalculation\n    wp_schedule_single_event(time() + 30, 'jobmatch_admin_recalc_all');\n    \n    wp_send_json_success('Recalculation scheduled');\n}\n\nadd_action('wp_ajax_jobmatch_test_score', 'jobmatch_ajax_test_score');\nfunction jobmatch_ajax_test_score() {\n    check_ajax_referer('jobmatch_admin', 'nonce');\n    \n    $developer_id = intval($_POST['developer_id']);\n    $job_id = intval($_POST['job_id']);\n    \n    $score_data = jobmatch_calculate_match_score($developer_id, $job_id, 'job');\n    \n    wp_send_json_success($score_data);\n}\n\n\/\/ Background task for admin score recalculation\nadd_action('jobmatch_admin_recalc_all', 'jobmatch_admin_recalculate_all_scores');\nfunction jobmatch_admin_recalculate_all_scores() {\n    $developers = get_users(array('meta_key' => 'user_role', 'meta_value' => 'developer', 'fields' => 'ID'));\n    \n    foreach ($developers as $dev_id) {\n        jobmatch_recalculate_user_scores($dev_id);\n        \/\/ Small delay to prevent server overload\n        usleep(100000); \/\/ 0.1 seconds\n    }\n}","active":true,"modified":"2025-09-24 19:36:27","revision":"1"}]}