{"generator":"Code Snippets v3.7.0","date_created":"2025-09-26 10:48","snippets":[{"id":34,"name":"Complete Connectivity Check for New Features","code":"\n\/**\n * Connectivity Check - Add this as a temporary snippet to test all connections\n * Run this by creating a page with shortcode: [jobmatch_connectivity_check]\n *\/\n\nadd_shortcode('jobmatch_connectivity_check', 'jobmatch_run_connectivity_check');\n\nfunction jobmatch_run_connectivity_check() {\n    if (!current_user_can('manage_options')) {\n        return 'Admin access required for connectivity check.';\n    }\n    \n    $results = array();\n    \n    \/\/ ===== 1. CHECK CORE FUNCTIONS =====\n    $results['Core Functions'] = array(\n        'jobmatch_create_notification' => function_exists('jobmatch_create_notification') ? '\u2705 EXISTS' : '\u274c MISSING',\n        'jobmatch_calculate_match_score' => function_exists('jobmatch_calculate_match_score') ? '\u2705 EXISTS' : '\u274c MISSING',\n        'jobmatch_get_anonymous_profile' => function_exists('jobmatch_get_anonymous_profile') ? '\u2705 EXISTS' : '\u274c MISSING',\n        'jobmatch_get_display_name' => function_exists('jobmatch_get_display_name') ? '\u2705 EXISTS' : '\u274c MISSING',\n        'jobmatch_geocode_postal' => function_exists('jobmatch_geocode_postal') ? '\u2705 EXISTS' : '\u274c MISSING',\n        'jobmatch_calculate_distance' => function_exists('jobmatch_calculate_distance') ? '\u2705 EXISTS' : '\u274c MISSING'\n    );\n    \n    \/\/ ===== 2. CHECK NEW FEATURES INTEGRATION =====\n    \n    \/\/ Job Alerts System\n    $results['Job Alerts'] = array(\n        'Alert function exists' => function_exists('jobmatch_alert_matched_developers') ? '\u2705 Connected' : '\u274c Not found',\n        'High match alerts' => function_exists('jobmatch_alert_high_match_jobs') ? '\u2705 Connected' : '\u274c Not found',\n        'Hook registered' => has_action('transition_post_status', 'jobmatch_alert_matched_developers') ? '\u2705 Active' : '\u274c Not hooked'\n    );\n    \n    \/\/ Subscription System (if added)\n    $results['Subscriptions'] = array(\n        'Packages function' => function_exists('jobmatch_get_subscription_packages') ? '\u2705 Connected' : '\u274c Not added yet',\n        'Purchase handler' => has_action('wp_ajax_jobmatch_create_subscription') ? '\u2705 Active' : '\u274c Not hooked',\n        'Webhook handler' => function_exists('jobmatch_handle_subscription_webhook') ? '\u2705 Connected' : '\u274c Not added yet'\n    );\n    \n    \/\/ Advanced Filters\n    $results['Advanced Filters'] = array(\n        'Filter handler' => has_action('wp_ajax_jobmatch_apply_advanced_filters') ? '\u2705 Active' : '\u274c Not hooked',\n        'Filter UI function' => function_exists('jobmatch_render_advanced_filters') ? '\u2705 Connected' : '\u274c Not found',\n        'Shortcode registered' => shortcode_exists('jobmatch_advanced_filters') ? '\u2705 Active' : '\u274c Not registered'\n    );\n    \n    \/\/ Radius Search\n    $results['Radius Search'] = array(\n        'Filter applied' => has_filter('pre_get_posts', 'jobmatch_apply_radius_filter') ? '\u2705 Active' : '\u274c Not hooked',\n        'UI renderer' => has_action('jobmatch_render_browse_filters', 'jobmatch_add_radius_filter_ui') ? '\u2705 Active' : '\u274c Not hooked',\n        'AJAX handler' => has_action('wp_ajax_jobmatch_filter_by_radius') ? '\u2705 Active' : '\u274c Not hooked',\n        'Shortcode' => shortcode_exists('jobmatch_radius_filter') ? '\u2705 Active' : '\u274c Not registered'\n    );\n    \n    \/\/ Geo-Location\n    $results['Geo-Location'] = array(\n        'Geocoding on profile' => has_action('profile_update', 'jobmatch_geocode_user_postal') ? '\u2705 Active' : '\u274c Not hooked',\n        'Location scoring' => has_filter('jobmatch_score_factors', 'jobmatch_add_precise_location_scoring') ? '\u2705 Active' : '\u274c Not hooked'\n    );\n    \n    \/\/ ===== 3. CHECK DATABASE CONNECTIVITY =====\n    global $wpdb;\n    \n    $results['Database Tables'] = array(\n        'notifications' => $wpdb->get_var(\"SHOW TABLES LIKE '{$wpdb->prefix}jobmatch_notifications'\") ? '\u2705 EXISTS' : '\u274c MISSING',\n        'geo_locations' => $wpdb->get_var(\"SHOW TABLES LIKE '{$wpdb->prefix}geo_locations'\") ? '\u2705 EXISTS' : '\u274c MISSING',\n        'credit_transactions' => $wpdb->get_var(\"SHOW TABLES LIKE '{$wpdb->prefix}credit_transactions'\") ? '\u2705 EXISTS' : '\u274c MISSING',\n        'match_scores' => $wpdb->get_var(\"SHOW TABLES LIKE '{$wpdb->prefix}match_scores'\") ? '\u2705 EXISTS' : '\u274c MISSING'\n    );\n    \n    \/\/ ===== 4. CHECK SHORTCODES =====\n    $results['Shortcodes'] = array(\n        'jobmatch_filters' => shortcode_exists('jobmatch_filters') ? '\u2705 Registered' : '\u274c Not found',\n        'jobmatch_advanced_filters' => shortcode_exists('jobmatch_advanced_filters') ? '\u2705 Registered' : '\u274c Not found',\n        'jobmatch_radius_filter' => shortcode_exists('jobmatch_radius_filter') ? '\u2705 Registered' : '\u274c Not found',\n        'jobmatch_subscription_manager' => shortcode_exists('jobmatch_subscription_manager') ? '\u2705 Registered' : '\u274c Not found',\n        'jobmatch_notification_preferences' => shortcode_exists('jobmatch_notification_preferences') ? '\u2705 Registered' : '\u274c Not found',\n        'jobmatch_notifications_list' => shortcode_exists('jobmatch_notifications_list') ? '\u2705 Registered' : '\u274c Not found'\n    );\n    \n    \/\/ ===== 5. CHECK AJAX ENDPOINTS =====\n    $ajax_actions = array(\n        'jobmatch_browse_with_filters',\n        'jobmatch_apply_advanced_filters',\n        'jobmatch_filter_by_radius',\n        'jobmatch_create_subscription',\n        'jobmatch_filter_browse'\n    );\n    \n    $results['AJAX Endpoints'] = array();\n    foreach ($ajax_actions as $action) {\n        $results['AJAX Endpoints'][$action] = has_action('wp_ajax_' . $action) ? '\u2705 Active' : '\u274c Not registered';\n    }\n    \n    \/\/ ===== 6. TEST SAMPLE FUNCTIONALITY =====\n    $results['Functional Tests'] = array();\n    \n    \/\/ Test geocoding (if function exists)\n    if (function_exists('jobmatch_geocode_postal')) {\n        $test_postal = '10115'; \/\/ Berlin\n        $coords = jobmatch_geocode_postal($test_postal);\n        $results['Functional Tests']['Geocoding'] = $coords ? '\u2705 Working (' . round($coords['lat'], 2) . ', ' . round($coords['lng'], 2) . ')' : '\u274c Failed';\n    } else {\n        $results['Functional Tests']['Geocoding'] = '\u274c Function missing';\n    }\n    \n    \/\/ Test distance calculation\n    if (function_exists('jobmatch_calculate_distance')) {\n        $distance = jobmatch_calculate_distance(52.52, 13.405, 48.135, 11.582); \/\/ Berlin to Munich\n        $results['Functional Tests']['Distance Calc'] = $distance > 0 ? '\u2705 Working (' . round($distance) . ' km)' : '\u274c Failed';\n    } else {\n        $results['Functional Tests']['Distance Calc'] = '\u274c Function missing';\n    }\n    \n    \/\/ Test notification creation (without actually creating one)\n    if (function_exists('jobmatch_create_notification')) {\n        $results['Functional Tests']['Notifications'] = '\u2705 Function ready';\n    } else {\n        $results['Functional Tests']['Notifications'] = '\u274c Function missing';\n    }\n    \n    \/\/ ===== 7. CHECK USER META SETUP =====\n    $test_user = get_users(array('number' => 1, 'role' => 'subscriber'))[0] ?? null;\n    if ($test_user) {\n        $results['User Meta Fields'] = array(\n            'postal_code' => get_user_meta($test_user->ID, 'postal_code', true) ? '\u2705 Set' : '\u26a0\ufe0f Not set',\n            'lat_lng' => get_user_meta($test_user->ID, 'lat_lng', true) ? '\u2705 Set' : '\u26a0\ufe0f Not geocoded',\n            'user_role' => get_user_meta($test_user->ID, 'user_role', true) ? '\u2705 Set' : '\u26a0\ufe0f Not set'\n        );\n    }\n    \n    \/\/ ===== RENDER RESULTS =====\n    ob_start();\n    ?>\n    <div style=\"max-width: 1200px; margin: 20px auto; font-family: -apple-system, sans-serif;\">\n        <h1>JobMatch Connectivity Check<\/h1>\n        <p style=\"background: #f0f4ff; padding: 15px; border-radius: 8px;\">\n            This checks if all new features are properly connected to your existing system.\n        <\/p>\n        \n        <?php foreach ($results as $category => $items): ?>\n            <div style=\"background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 20px; margin: 20px 0;\">\n                <h2 style=\"margin-top: 0; color: #333; border-bottom: 2px solid #667eea; padding-bottom: 10px;\">\n                    <?php echo $category; ?>\n                <\/h2>\n                <table style=\"width: 100%; border-collapse: collapse;\">\n                    <?php foreach ($items as $item => $status): ?>\n                        <tr style=\"border-bottom: 1px solid #f0f0f0;\">\n                            <td style=\"padding: 10px 0; color: #666;\">\n                                <?php echo $item; ?>\n                            <\/td>\n                            <td style=\"padding: 10px 0; text-align: right; font-weight: bold;\">\n                                <?php echo $status; ?>\n                            <\/td>\n                        <\/tr>\n                    <?php endforeach; ?>\n                <\/table>\n            <\/div>\n        <?php endforeach; ?>\n        \n        <div style=\"background: #fffbf0; border: 1px solid #ffc107; border-radius: 8px; padding: 20px; margin: 20px 0;\">\n            <h3 style=\"margin-top: 0;\">\ud83d\udccb Action Items<\/h3>\n            <ol>\n                <?php\n                $has_issues = false;\n                foreach ($results as $category => $items) {\n                    foreach ($items as $item => $status) {\n                        if (strpos($status, '\u274c') !== false) {\n                            echo '<li><strong>' . $category . ' - ' . $item . ':<\/strong> Needs to be added or activated<\/li>';\n                            $has_issues = true;\n                        }\n                    }\n                }\n                if (!$has_issues) {\n                    echo '<li style=\"color: green;\">\u2705 All systems connected and functional!<\/li>';\n                }\n                ?>\n            <\/ol>\n        <\/div>\n        \n        <div style=\"background: #f8f9fa; border-radius: 8px; padding: 20px; margin: 20px 0;\">\n            <h3>\ud83d\udd0d How to Fix Issues:<\/h3>\n            <ul>\n                <li><strong>Missing Functions:<\/strong> Check if the relevant Code Snippet is active<\/li>\n                <li><strong>Not Hooked:<\/strong> The snippet exists but may not be active<\/li>\n                <li><strong>Shortcode Not Found:<\/strong> Add the shortcode definition to the snippet<\/li>\n                <li><strong>Table Missing:<\/strong> Run the database setup function<\/li>\n                <li><strong>Not Geocoded:<\/strong> User needs to update profile or add postal code<\/li>\n            <\/ul>\n        <\/div>\n    <\/div>\n    <?php\n    return ob_get_clean();\n}","active":true,"modified":"2025-09-24 20:48:22","revision":"1"}]}