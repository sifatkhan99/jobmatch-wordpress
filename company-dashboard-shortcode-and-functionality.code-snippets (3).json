{"generator":"Code Snippets v3.7.0","date_created":"2025-09-26 10:47","snippets":[{"id":14,"name":"Company Dashboard Shortcode and Functionality","code":"\n\/**\n * Company Dashboard Shortcode and Functionality\n * Add this to Code Snippets plugin\n * Use shortcode [company_dashboard] on your Company Dashboard page\n *\/\n\n\/\/ Company Dashboard Shortcode\nadd_shortcode('company_dashboard', 'jobmatch_company_dashboard');\n\nfunction jobmatch_company_dashboard($atts) {\n    \/\/ Security check\n    if (!is_user_logged_in()) {\n        return '<p>Please <a href=\"' . wp_login_url() . '\">log in<\/a> to access your dashboard.<\/p>';\n    }\n    \n    $current_user = wp_get_current_user();\n    $user_role = get_user_meta($current_user->ID, 'user_role', true);\n    \n    if ($user_role !== 'company') {\n        return '<p>Access denied. This dashboard is for companies only.<\/p>';\n    }\n    \n    \/\/ Check if onboarding is complete\n    $onboarding_complete = get_user_meta($current_user->ID, 'onboarding_complete', true);\n    if (!$onboarding_complete) {\n        wp_redirect(home_url('\/onboarding\/'));\n        exit;\n    }\n    \n    $atts = shortcode_atts(array(\n        'view' => 'overview'\n    ), $atts);\n    \n    \/\/ Get current view from URL parameter\n    $current_view = $_GET['view'] ?? $atts['view'];\n    \n    ob_start();\n    ?>\n    \n    <div class=\"company-dashboard\">\n        <!-- Dashboard Header -->\n        <div class=\"dashboard-header\">\n            <div class=\"user-welcome\">\n                <?php echo jobmatch_get_display_avatar($current_user->ID, null, 'large'); ?>\n                <div class=\"welcome-text\">\n                    <h1>Welcome back, <?php echo jobmatch_get_display_name($current_user->ID); ?>!<\/h1>\n                    <p><?php echo esc_html(get_user_meta($current_user->ID, 'company_description', true) ?: 'Complete your company profile to attract top talent'); ?><\/p>\n                <\/div>\n            <\/div>\n            \n            <div class=\"company-stats\">\n                <?php echo jobmatch_render_company_stats($current_user->ID); ?>\n            <\/div>\n        <\/div>\n\n        <!-- Dashboard Navigation -->\n        <nav class=\"dashboard-nav\">\n            <a href=\"?view=overview\" class=\"nav-item <?php echo $current_view === 'overview' ? 'active' : ''; ?>\">\n                \ud83d\udcca Overview\n            <\/a>\n            <a href=\"?view=browse-developers\" class=\"nav-item <?php echo $current_view === 'browse-developers' ? 'active' : ''; ?>\">\n                \ud83d\udc68\u200d\ud83d\udcbb Browse Developers\n            <\/a>\n            <a href=\"?view=my-jobs\" class=\"nav-item <?php echo $current_view === 'my-jobs' ? 'active' : ''; ?>\">\n                \ud83d\udcbc My Jobs\n            <\/a>\n            <a href=\"?view=matches\" class=\"nav-item <?php echo $current_view === 'matches' ? 'active' : ''; ?>\">\n                \u2764\ufe0f My Matches\n            <\/a>\n            <a href=\"?view=messages\" class=\"nav-item <?php echo $current_view === 'messages' ? 'active' : ''; ?>\">\n                \ud83d\udcac Messages\n                <?php \n                $unread_count = jobmatch_get_unread_messages_count($current_user->ID);\n                if ($unread_count > 0) echo '<span class=\"badge\">' . $unread_count . '<\/span>';\n                ?>\n            <\/a>\n            <a href=\"?view=wallet\" class=\"nav-item <?php echo $current_view === 'wallet' ? 'active' : ''; ?>\">\n                \ud83d\udcb0 Wallet\n            <\/a>\n            <a href=\"?view=profile\" class=\"nav-item <?php echo $current_view === 'profile' ? 'active' : ''; ?>\">\n                \ud83c\udfe2 Company Profile\n            <\/a>\n        <\/nav>\n\n        <!-- Dashboard Content -->\n        <div class=\"dashboard-content\">\n            <?php\n            switch ($current_view) {\n                case 'overview':\n                    echo jobmatch_render_company_overview($current_user->ID);\n                    break;\n                case 'browse-developers':\n                    echo jobmatch_render_developer_browser($current_user->ID);\n                    break;\n                case 'my-jobs':\n                    echo jobmatch_render_company_jobs($current_user->ID);\n                    break;\n                case 'matches':\n                    echo jobmatch_render_matches($current_user->ID);\n                    break;\n                case 'messages':\n                    echo jobmatch_render_messages($current_user->ID);\n                    break;\n                case 'wallet':\n                    echo jobmatch_render_wallet($current_user->ID);\n                    break;\n                case 'profile':\n                    echo jobmatch_render_company_profile_editor($current_user->ID);\n                    break;\n                default:\n                    echo jobmatch_render_company_overview($current_user->ID);\n            }\n            ?>\n        <\/div>\n    <\/div>\n\n    <?php\n    return ob_get_clean();\n}\n\n\/\/ Render company statistics\nfunction jobmatch_render_company_stats($user_id) {\n    $stats = jobmatch_get_match_stats($user_id);\n    $credit_balance = jobmatch_get_credit_balance($user_id);\n    $active_jobs = wp_count_posts('jobs')->publish ?? 0;\n    \n    ob_start();\n    ?>\n    <div class=\"stats-grid\">\n        <div class=\"stat-card credit-card\">\n            <div class=\"stat-number\"><?php echo $credit_balance; ?><\/div>\n            <div class=\"stat-label\">Credits<\/div>\n            <?php if ($credit_balance < 5): ?>\n                <a href=\"?view=wallet\" class=\"low-credit-warning\">\u26a0\ufe0f Low Balance<\/a>\n            <?php endif; ?>\n        <\/div>\n        <div class=\"stat-card\">\n            <div class=\"stat-number\"><?php echo $active_jobs; ?><\/div>\n            <div class=\"stat-label\">Active Jobs<\/div>\n        <\/div>\n        <div class=\"stat-card\">\n            <div class=\"stat-number\"><?php echo $stats['mutual']; ?><\/div>\n            <div class=\"stat-label\">Mutual Matches<\/div>\n        <\/div>\n        <div class=\"stat-card\">\n            <div class=\"stat-number\"><?php echo $stats['chatting']; ?><\/div>\n            <div class=\"stat-label\">Active Chats<\/div>\n        <\/div>\n    <\/div>\n    <?php\n    return ob_get_clean();\n}\n\n\/\/ Render company overview\nfunction jobmatch_render_company_overview($user_id) {\n    $recent_matches = jobmatch_get_user_matches($user_id, 'all', 5);\n    $top_developers = jobmatch_get_top_matches($user_id, 'developer', 5);\n    $recent_jobs = get_posts(array(\n        'post_type' => 'jobs',\n        'author' => $user_id,\n        'numberposts' => 3,\n        'post_status' => 'publish'\n    ));\n    $notifications = jobmatch_get_user_notifications($user_id, 5);\n    \n    ob_start();\n    ?>\n    <div class=\"overview-grid\">\n        <!-- Credit Status & Quick Actions -->\n        <div class=\"overview-section credit-overview\">\n            <h3>\ud83d\udcb0 Credit Status<\/h3>\n            <?php echo jobmatch_render_credit_overview($user_id); ?>\n        <\/div>\n\n        <!-- Recent Matches -->\n        <div class=\"overview-section\">\n            <h3>\ud83d\udd25 Recent Activity<\/h3>\n            <?php if (!empty($recent_matches)): ?>\n                <div class=\"activity-list\">\n                    <?php foreach ($recent_matches as $match): ?>\n                        <?php\n                        $developer_id = $match->developer_id;\n                        $developer_name = jobmatch_get_display_name($developer_id, $user_id);\n                        $time_ago = human_time_diff(strtotime($match->post_date));\n                        $job_id = get_post_meta($match->ID, 'job_id', true);\n                        $job_title = $job_id ? get_the_title($job_id) : 'General interest';\n                        ?>\n                        <div class=\"activity-item\">\n                            <?php echo jobmatch_get_display_avatar($developer_id, $user_id, 'small'); ?>\n                            <div class=\"activity-text\">\n                                <strong><?php echo esc_html($developer_name); ?><\/strong>\n                                <span class=\"activity-action\">\n                                    <?php\n                                    switch ($match->match_status) {\n                                        case 'developer_liked':\n                                            echo 'liked your job: ' . $job_title;\n                                            break;\n                                        case 'mutual':\n                                            echo 'matched with you';\n                                            break;\n                                        case 'chatting':\n                                            echo 'is chatting with you';\n                                            break;\n                                        default:\n                                            echo 'interacted with you';\n                                    }\n                                    ?>\n                                <\/span>\n                                <span class=\"activity-time\"><?php echo $time_ago; ?> ago<\/span>\n                            <\/div>\n                            <?php if ($match->match_status === 'developer_liked'): ?>\n                                <button class=\"btn-quick-match\" onclick=\"quickMatchBack(<?php echo $developer_id; ?>)\">\ud83d\udc9a Match<\/button>\n                            <?php endif; ?>\n                        <\/div>\n                    <?php endforeach; ?>\n                <\/div>\n            <?php else: ?>\n                <p class=\"empty-state\">No recent activity. Post a job or browse developers to get started!<\/p>\n            <?php endif; ?>\n        <\/div>\n\n        <!-- Top Developer Matches -->\n        <div class=\"overview-section\">\n            <h3>\ud83c\udfaf Top Developer Matches<\/h3>\n            <?php if (!empty($top_developers)): ?>\n                <div class=\"top-matches\">\n                    <?php foreach ($top_developers as $dev_match): ?>\n                        <?php\n                        $developer_id = $dev_match->target_id;\n                        $developer_profile = jobmatch_get_anonymous_profile($developer_id, $user_id);\n                        ?>\n                        <div class=\"match-preview\">\n                            <div class=\"match-header\">\n                                <?php echo jobmatch_get_display_avatar($developer_id, $user_id, 'small'); ?>\n                                <div class=\"match-info\">\n                                    <h4><?php echo esc_html($developer_profile['name']); ?><\/h4>\n                                    <p><?php echo esc_html($developer_profile['location']); ?><\/p>\n                                    <?php if (!empty($developer_profile['tech_skills'])): ?>\n                                        <div class=\"mini-skills\">\n                                            <?php foreach (array_slice($developer_profile['tech_skills'], 0, 3) as $skill): ?>\n                                                <span class=\"mini-tech-tag\"><?php echo esc_html($skill); ?><\/span>\n                                            <?php endforeach; ?>\n                                        <\/div>\n                                    <?php endif; ?>\n                                <\/div>\n                                <div class=\"match-score excellent\"><?php echo $dev_match->score; ?>%<\/div>\n                            <\/div>\n                            <div class=\"match-actions\">\n                                <button class=\"btn-view\" onclick=\"viewDeveloper(<?php echo $developer_id; ?>)\">View Profile<\/button>\n                                <button class=\"btn-like\" onclick=\"likeDeveloper(<?php echo $developer_id; ?>)\">\u2764\ufe0f Like<\/button>\n                            <\/div>\n                        <\/div>\n                    <?php endforeach; ?>\n                <\/div>\n                <a href=\"?view=browse-developers\" class=\"view-all\">Browse More Developers<\/a>\n            <?php else: ?>\n                <p class=\"empty-state\">Post jobs to see personalized developer recommendations.<\/p>\n            <?php endif; ?>\n        <\/div>\n\n        <!-- Recent Jobs -->\n        <div class=\"overview-section\">\n            <h3>\ud83d\udcbc Your Recent Jobs<\/h3>\n            <?php if (!empty($recent_jobs)): ?>\n                <div class=\"recent-jobs\">\n                    <?php foreach ($recent_jobs as $job): ?>\n                        <?php\n                        $applications = jobmatch_get_job_applications($job->ID);\n                        $views = get_post_meta($job->ID, 'job_views', true) ?: 0;\n                        ?>\n                        <div class=\"job-item\">\n                            <div class=\"job-info\">\n                                <h4><a href=\"<?php echo get_permalink($job->ID); ?>\"><?php echo esc_html($job->post_title); ?><\/a><\/h4>\n                                <p class=\"job-stats\">\n                                    \ud83d\udc41\ufe0f <?php echo $views; ?> views \u2022 \n                                    \u2764\ufe0f <?php echo count($applications); ?> interested \u2022 \n                                    \ud83d\udcc5 Posted <?php echo human_time_diff(strtotime($job->post_date)); ?> ago\n                                <\/p>\n                            <\/div>\n                            <div class=\"job-actions\">\n                                <a href=\"<?php echo get_edit_post_link($job->ID); ?>\" class=\"btn-edit\">\u270f\ufe0f Edit<\/a>\n                                <a href=\"<?php echo get_permalink($job->ID); ?>\" class=\"btn-view\">\ud83d\udc41\ufe0f View<\/a>\n                            <\/div>\n                        <\/div>\n                    <?php endforeach; ?>\n                <\/div>\n                <a href=\"?view=my-jobs\" class=\"view-all\">Manage All Jobs<\/a>\n            <?php else: ?>\n                <p class=\"empty-state\">You haven't posted any jobs yet.<\/p>\n                <a href=\"<?php echo home_url('\/post-job\/'); ?>\" class=\"btn-primary\">\ud83d\udcdd Post Your First Job<\/a>\n            <?php endif; ?>\n        <\/div>\n\n        <!-- Notifications -->\n        <div class=\"overview-section\">\n            <h3>\ud83d\udd14 Recent Notifications<\/h3>\n            <?php if (!empty($notifications)): ?>\n                <div class=\"notifications-list\">\n                    <?php foreach ($notifications as $notification): ?>\n                        <div class=\"notification-item <?php echo $notification->is_read ? 'read' : 'unread'; ?>\">\n                            <div class=\"notification-icon\">\n                                <?php\n                                $icons = array(\n                                    'new_match' => '\ud83d\udc99',\n                                    'mutual_match' => '\ud83c\udf89',\n                                    'developer_interested' => '\ud83d\udc4b',\n                                    'message' => '\ud83d\udcac',\n                                    'low_credits' => '\u26a0\ufe0f',\n                                    'job_view' => '\ud83d\udc41\ufe0f'\n                                );\n                                echo $icons[$notification->type] ?? '\ud83d\udce2';\n                                ?>\n                            <\/div>\n                            <div class=\"notification-content\">\n                                <h4><?php echo esc_html($notification->title); ?><\/h4>\n                                <p><?php echo esc_html($notification->message); ?><\/p>\n                                <span class=\"notification-time\"><?php echo human_time_diff(strtotime($notification->created_at)); ?> ago<\/span>\n                            <\/div>\n                            <?php if (!$notification->is_read): ?>\n                                <button class=\"mark-read\" onclick=\"markNotificationRead(<?php echo $notification->id; ?>)\">\u2714<\/button>\n                            <?php endif; ?>\n                        <\/div>\n                    <?php endforeach; ?>\n                <\/div>\n            <?php else: ?>\n                <p class=\"empty-state\">No notifications yet.<\/p>\n            <?php endif; ?>\n        <\/div>\n\n        <!-- Quick Actions -->\n        <div class=\"overview-section quick-actions\">\n            <h3>\u26a1 Quick Actions<\/h3>\n            <div class=\"action-buttons\">\n                <a href=\"<?php echo home_url('\/post-job\/'); ?>\" class=\"action-btn primary\">\n                    \ud83d\udcdd Post New Job\n                <\/a>\n                <a href=\"?view=browse-developers\" class=\"action-btn\">\n                    \ud83d\udd0d Browse Developers\n                <\/a>\n                <a href=\"?view=wallet\" class=\"action-btn\">\n                    \ud83d\udcb0 Buy Credits\n                <\/a>\n                <a href=\"?view=profile\" class=\"action-btn\">\n                    \u2699\ufe0f Edit Profile\n                <\/a>\n            <\/div>\n        <\/div>\n    <\/div>\n    \n    <script>\n    function quickMatchBack(developerId) {\n        jQuery.post(ajaxurl, {\n            action: 'handle_match_action',\n            target_user_id: developerId,\n            action: 'like',\n            nonce: jobmatch_nonce\n        }, function(response) {\n            if (response.success) {\n                if (response.data.status === 'mutual_match') {\n                    showMatchModal(response.data);\n                } else {\n                    location.reload();\n                }\n            } else {\n                alert('Error: ' + response.data);\n            }\n        });\n    }\n    \n    function likeDeveloper(developerId) {\n        jQuery.post(ajaxurl, {\n            action: 'handle_match_action',\n            target_user_id: developerId,\n            action: 'like',\n            nonce: jobmatch_nonce\n        }, function(response) {\n            if (response.success) {\n                const button = event.target;\n                if (response.data.status === 'mutual_match') {\n                    showMatchModal(response.data);\n                    button.textContent = '\ud83d\udcac Chat Now';\n                    button.onclick = () => openChat(response.data.match_id);\n                } else {\n                    button.textContent = '\u23f3 Liked';\n                    button.disabled = true;\n                }\n            } else {\n                alert('Error: ' + response.data);\n            }\n        });\n    }\n    \n    function viewDeveloper(developerId) {\n        window.location.href = '<?php echo home_url('\/developer-profile\/'); ?>?user=' + developerId;\n    }\n    <\/script>\n    <?php\n    return ob_get_clean();\n}\n\n\/\/ Render credit overview widget\nfunction jobmatch_render_credit_overview($user_id) {\n    $credit_balance = jobmatch_get_credit_balance($user_id);\n    $recent_transactions = jobmatch_get_recent_transactions($user_id, 3);\n    \n    ob_start();\n    ?>\n    <div class=\"credit-overview-widget\">\n        <div class=\"credit-balance\">\n            <div class=\"balance-display\">\n                <span class=\"balance-amount\"><?php echo $credit_balance; ?><\/span>\n                <span class=\"balance-label\">Credits Available<\/span>\n            <\/div>\n            <?php if ($credit_balance < 5): ?>\n                <div class=\"low-balance-warning\">\n                    \u26a0\ufe0f Running low on credits\n                <\/div>\n            <?php endif; ?>\n        <\/div>\n        \n        <div class=\"credit-actions\">\n            <a href=\"?view=wallet\" class=\"btn-buy-credits\">\ud83d\udcb0 Buy More Credits<\/a>\n            <a href=\"?view=wallet\" class=\"btn-view-history\">\ud83d\udcca View History<\/a>\n        <\/div>\n        \n        <?php if (!empty($recent_transactions)): ?>\n            <div class=\"recent-transactions\">\n                <h5>Recent Transactions<\/h5>\n                <?php foreach ($recent_transactions as $transaction): ?>\n                    <div class=\"transaction-item\">\n                        <span class=\"transaction-description\"><?php echo esc_html($transaction->description); ?><\/span>\n                        <span class=\"transaction-amount <?php echo $transaction->amount > 0 ? 'positive' : 'negative'; ?>\">\n                            <?php echo $transaction->amount > 0 ? '+' : ''; ?><?php echo $transaction->amount; ?>\n                        <\/span>\n                    <\/div>\n                <?php endforeach; ?>\n            <\/div>\n        <?php endif; ?>\n    <\/div>\n    <?php\n    return ob_get_clean();\n}\n\n\/\/ Get recent credit transactions\nfunction jobmatch_get_recent_transactions($user_id, $limit = 5) {\n    global $wpdb;\n    \n    $table_name = $wpdb->prefix . 'credit_transactions';\n    \n    return $wpdb->get_results($wpdb->prepare(\"\n        SELECT * FROM $table_name \n        WHERE user_id = %d \n        ORDER BY created_at DESC \n        LIMIT %d\n    \", $user_id, $limit));\n}\n\n\/\/ Render developer browser for companies\nfunction jobmatch_render_developer_browser($user_id) {\n    $filters = array(\n        'tech_stack' => $_GET['tech_stack'] ?? '',\n        'location' => $_GET['location'] ?? '',\n        'salary_max' => $_GET['salary_max'] ?? '',\n        'experience' => $_GET['experience'] ?? '',\n        'work_preference' => $_GET['work_preference'] ?? ''\n    );\n    \n    ob_start();\n    ?>\n    <div class=\"developer-browser\">\n        <div class=\"browser-header\">\n            <h2>\ud83d\udc68\u200d\ud83d\udcbb Browse Developers<\/h2>\n            <p>Find the perfect talent for your team<\/p>\n        <\/div>\n\n        <!-- Developer Filters -->\n        <div class=\"developer-filters\">\n            <form method=\"GET\" class=\"filter-form\">\n                <input type=\"hidden\" name=\"view\" value=\"browse-developers\">\n                \n                <div class=\"filter-row\">\n                    <div class=\"filter-group\">\n                        <label>Tech Stack<\/label>\n                        <select name=\"tech_stack\">\n                            <option value=\"\">All Technologies<\/option>\n                            <?php\n                            $tech_terms = get_terms(array('taxonomy' => 'tech_stack', 'hide_empty' => false));\n                            foreach ($tech_terms as $term) {\n                                $selected = $filters['tech_stack'] === $term->slug ? 'selected' : '';\n                                echo \"<option value='{$term->slug}' {$selected}>{$term->name}<\/option>\";\n                            }\n                            ?>\n                        <\/select>\n                    <\/div>\n                    \n                    <div class=\"filter-group\">\n                        <label>Location<\/label>\n                        <select name=\"location\">\n                            <option value=\"\">All Locations<\/option>\n                            <option value=\"remote\" <?php selected($filters['location'], 'remote'); ?>>Remote OK<\/option>\n                            <option value=\"berlin\" <?php selected($filters['location'], 'berlin'); ?>>Berlin<\/option>\n                            <option value=\"munich\" <?php selected($filters['location'], 'munich'); ?>>Munich<\/option>\n                            <option value=\"hamburg\" <?php selected($filters['location'], 'hamburg'); ?>>Hamburg<\/option>\n                            <option value=\"frankfurt\" <?php selected($filters['location'], 'frankfurt'); ?>>Frankfurt<\/option>\n                        <\/select>\n                    <\/div>\n                    \n                    <div class=\"filter-group\">\n                        <label>Max Salary (\u20ac)<\/label>\n                        <input type=\"number\" name=\"salary_max\" value=\"<?php echo esc_attr($filters['salary_max']); ?>\" placeholder=\"80000\" step=\"1000\">\n                    <\/div>\n                    \n                    <div class=\"filter-group\">\n                        <label>Experience Level<\/label>\n                        <select name=\"experience\">\n                            <option value=\"\">All Levels<\/option>\n                            <option value=\"junior\" <?php selected($filters['experience'], 'junior'); ?>>Junior<\/option>\n                            <option value=\"mid\" <?php selected($filters['experience'], 'mid'); ?>>Mid-level<\/option>\n                            <option value=\"senior\" <?php selected($filters['experience'], 'senior'); ?>>Senior<\/option>\n                            <option value=\"lead\" <?php selected($filters['experience'], 'lead'); ?>>Lead<\/option>\n                        <\/select>\n                    <\/div>\n                    \n                    <div class=\"filter-group\">\n                        <label>Work Preference<\/label>\n                        <select name=\"work_preference\">\n                            <option value=\"\">Any<\/option>\n                            <option value=\"remote\" <?php selected($filters['work_preference'], 'remote'); ?>>Remote<\/option>\n                            <option value=\"onsite\" <?php selected($filters['work_preference'], 'onsite'); ?>>On-site<\/option>\n                            <option value=\"hybrid\" <?php selected($filters['work_preference'], 'hybrid'); ?>>Hybrid<\/option>\n                        <\/select>\n                    <\/div>\n                    \n                    <button type=\"submit\" class=\"btn-filter\">\ud83d\udd0d Filter<\/button>\n                    <a href=\"?view=browse-developers\" class=\"btn-clear\">Clear<\/a>\n                <\/div>\n            <\/form>\n        <\/div>\n\n        <!-- Developer Results -->\n        <div class=\"developer-results\">\n            <?php echo jobmatch_render_filtered_developers($user_id, $filters); ?>\n        <\/div>\n    <\/div>\n    <?php\n    return ob_get_clean();\n}\n\n\/\/ Render filtered developers\nfunction jobmatch_render_filtered_developers($user_id, $filters) {\n    $args = array(\n        'role' => 'developer',\n        'number' => 20,\n        'meta_query' => array(\n            array(\n                'key' => 'user_role',\n                'value' => 'developer',\n                'compare' => '='\n            )\n        )\n    );\n    \n    \/\/ Apply filters\n    if ($filters['experience']) {\n        $args['meta_query'][] = array(\n            'key' => 'experience_level',\n            'value' => $filters['experience'],\n            'compare' => '='\n        );\n    }\n    \n    if ($filters['salary_max']) {\n        $args['meta_query'][] = array(\n            'key' => 'salary_expectation',\n            'value' => intval($filters['salary_max']),\n            'compare' => '<='\n        );\n    }\n    \n    if ($filters['work_preference']) {\n        $args['meta_query'][] = array(\n            'key' => 'work_preference',\n            'value' => $filters['work_preference'],\n            'compare' => '='\n        );\n    }\n    \n    if ($filters['tech_stack']) {\n        $args['meta_query'][] = array(\n            'key' => 'tech_skills',\n            'value' => $filters['tech_stack'],\n            'compare' => 'LIKE'\n        );\n    }\n    \n    $developers = get_users($args);\n    \n    if (empty($developers)) {\n        return '<div class=\"no-results\">No developers found matching your criteria. Try adjusting your filters.<\/div>';\n    }\n    \n    ob_start();\n    ?>\n    <div class=\"developers-grid\">\n        <?php foreach ($developers as $developer): ?>\n            <?php\n            $developer_profile = jobmatch_get_anonymous_profile($developer->ID, $user_id);\n            $match_score = jobmatch_get_match_score($user_id, $developer->ID, 'developer');\n            ?>\n            \n            <div class=\"developer-card\" data-developer-id=\"<?php echo $developer->ID; ?>\">\n                <div class=\"developer-header\">\n                    <?php echo jobmatch_get_display_avatar($developer->ID, $user_id, 'medium'); ?>\n                    <div class=\"developer-info\">\n                        <h3><?php echo esc_html($developer_profile['name']); ?><\/h3>\n                        <p class=\"developer-location\"><?php echo esc_html($developer_profile['location']); ?><\/p>\n                        <p class=\"developer-level\">\n                            <?php echo ucfirst($developer_profile['experience_level']); ?> \u2022 \n                            <?php echo ucfirst($developer_profile['work_preference']); ?>\n                        <\/p>\n                    <\/div>\n                    <?php if ($match_score): ?>\n                        <div class=\"match-score <?php echo jobmatch_get_score_class($match_score->score); ?>\">\n                            <?php echo $match_score->score; ?>%\n                        <\/div>\n                    <?php endif; ?>\n                <\/div>\n                \n                <div class=\"developer-details\">\n                    <?php if ($developer_profile['salary_expectation']): ?>\n                        <p class=\"salary\">\ud83d\udcb0 \u20ac<?php echo number_format($developer_profile['salary_expectation']); ?> expected<\/p>\n                    <?php endif; ?>\n                    \n                    <?php if (!empty($developer_profile['tech_skills'])): ?>\n                        <div class=\"tech-skills\">\n                            <?php foreach (array_slice($developer_profile['tech_skills'], 0, 6) as $skill): ?>\n                                <span class=\"tech-tag\"><?php echo esc_html($skill); ?><\/span>\n                            <?php endforeach; ?>\n                            <?php if (count($developer_profile['tech_skills']) > 6): ?>\n                                <span class=\"tech-tag more\">+<?php echo count($developer_profile['tech_skills']) - 6; ?> more<\/span>\n                            <?php endif; ?>\n                        <\/div>\n                    <?php endif; ?>\n                    \n                    <?php if ($developer_profile['profile_summary']): ?>\n                        <div class=\"developer-bio\">\n                            <?php echo wp_trim_words($developer_profile['profile_summary'], 15); ?>\n                        <\/div>\n                    <?php endif; ?>\n                <\/div>\n                \n                <div class=\"developer-actions\">\n                    <button class=\"btn-like\" onclick=\"likeDeveloper(<?php echo $developer->ID; ?>)\">\n                        \u2764\ufe0f Like\n                    <\/button>\n                    <button class=\"btn-pass\" onclick=\"passDeveloper(<?php echo $developer->ID; ?>)\">\n                        \ud83d\udc4b Pass\n                    <\/button>\n                    <button class=\"btn-view\" onclick=\"viewDeveloper(<?php echo $developer->ID; ?>)\">\ud83d\udc41\ufe0f View Profile<\/button>\n                <\/div>\n            <\/div>\n        <?php endforeach; ?>\n    <\/div>\n    \n    <script>\n    function passDeveloper(developerId) {\n        if (confirm('Are you sure you want to pass on this developer?')) {\n            jQuery.post(ajaxurl, {\n                action: 'handle_match_action',\n                target_user_id: developerId,\n                action: 'pass',\n                nonce: jobmatch_nonce\n            }, function(response) {\n                if (response.success) {\n                    const developerCard = document.querySelector(`[data-developer-id=\"${developerId}\"]`);\n                    developerCard.style.opacity = '0.5';\n                    developerCard.querySelector('.btn-pass').textContent = '\u2714 Passed';\n                }\n            });\n        }\n    }\n    <\/script>\n    <?php\n    return ob_get_clean();\n}\n\n\/\/ Get job applications (developers who liked the job)\nfunction jobmatch_get_job_applications($job_id) {\n    global $wpdb;\n    \n    return $wpdb->get_results($wpdb->prepare(\"\n        SELECT p.*, pm_dev.meta_value as developer_id, pm_status.meta_value as match_status\n        FROM {$wpdb->posts} p\n        LEFT JOIN {$wpdb->postmeta} pm_dev ON p.ID = pm_dev.post_id AND pm_dev.meta_key = 'developer_id'\n        LEFT JOIN {$wpdb->postmeta} pm_status ON p.ID = pm_status.post_id AND pm_status.meta_key = 'match_status'\n        LEFT JOIN {$wpdb->postmeta} pm_job ON p.ID = pm_job.post_id AND pm_job.meta_key = 'job_id'\n        WHERE p.post_type = 'matches'\n        AND p.post_status = 'publish'\n        AND pm_job.meta_value = %s\n        AND pm_status.meta_value IN ('developer_liked', 'mutual', 'revealed', 'chatting')\n    \", $job_id));\n}\n\n\/\/ Render company jobs management\nfunction jobmatch_render_company_jobs($user_id) {\n    $jobs = get_posts(array(\n        'post_type' => 'jobs',\n        'author' => $user_id,\n        'numberposts' => -1,\n        'post_status' => array('publish', 'draft', 'pending')\n    ));\n    \n    ob_start();\n    ?>\n    <div class=\"company-jobs-manager\">\n        <div class=\"jobs-header\">\n            <h2>\ud83d\udcbc Manage Your Jobs<\/h2>\n            <a href=\"<?php echo home_url('\/post-job\/'); ?>\" class=\"btn-primary\">\ud83d\udcdd Post New Job<\/a>\n        <\/div>\n\n        <?php if (!empty($jobs)): ?>\n            <div class=\"jobs-list\">\n                <?php foreach ($jobs as $job): ?>\n                    <?php\n                    $applications = jobmatch_get_job_applications($job->ID);\n                    $views = get_post_meta($job->ID, 'job_views', true) ?: 0;\n                    $salary_min = get_post_meta($job->ID, 'salary_min', true);\n                    $salary_max = get_post_meta($job->ID, 'salary_max', true);\n                    $job_location = get_post_meta($job->ID, 'job_location', true);\n                    $remote_work = get_post_meta($job->ID, 'remote_work', true);\n                    $tech_skills = wp_get_post_terms($job->ID, 'tech_stack', array('fields' => 'names'));\n                    ?>\n                    \n                    <div class=\"job-item-detailed\">\n                        <div class=\"job-main-info\">\n                            <div class=\"job-header\">\n                                <h3>\n                                    <a href=\"<?php echo get_permalink($job->ID); ?>\"><?php echo esc_html($job->post_title); ?><\/a>\n                                    <span class=\"job-status status-<?php echo $job->post_status; ?>\"><?php echo ucfirst($job->post_status); ?><\/span>\n                                <\/h3>\n                                <div class=\"job-meta\">\n                                    \ud83d\udcc5 Posted <?php echo human_time_diff(strtotime($job->post_date)); ?> ago \u2022\n                                    \ud83d\udccd <?php echo $remote_work ? 'Remote' : esc_html($job_location); ?> \u2022\n                                    \ud83d\udcb0 \u20ac<?php echo number_format($salary_min); ?><?php echo $salary_max ? ' - \u20ac' . number_format($salary_max) : ''; ?>\n                                <\/div>\n                            <\/div>\n                            \n                            <?php if (!empty($tech_skills)): ?>\n                                <div class=\"job-tech-skills\">\n                                    <?php foreach ($tech_skills as $skill): ?>\n                                        <span class=\"tech-tag\"><?php echo esc_html($skill); ?><\/span>\n                                    <?php endforeach; ?>\n                                <\/div>\n                            <?php endif; ?>\n                        <\/div>\n                        \n                        <div class=\"job-stats\">\n                            <div class=\"stat-item\">\n                                <span class=\"stat-number\"><?php echo $views; ?><\/span>\n                                <span class=\"stat-label\">Views<\/span>\n                            <\/div>\n                            <div class=\"stat-item\">\n                                <span class=\"stat-number\"><?php echo count($applications); ?><\/span>\n                                <span class=\"stat-label\">Interested<\/span>\n                            <\/div>\n                            <div class=\"stat-item\">\n                                <span class=\"stat-number\"><?php echo count(array_filter($applications, function($app) { return in_array($app->match_status, array('mutual', 'revealed', 'chatting')); })); ?><\/span>\n                                <span class=\"stat-label\">Matches<\/span>\n                            <\/div>\n                        <\/div>\n                        \n                        <div class=\"job-actions\">\n                            <?php if ($job->post_status === 'publish'): ?>\n                                <a href=\"?view=job-applications&job_id=<?php echo $job->ID; ?>\" class=\"btn-view-applications\">\n                                    \ud83d\udc65 View Applications (<?php echo count($applications); ?>)\n                                <\/a>\n                            <?php endif; ?>\n                            <a href=\"<?php echo get_edit_post_link($job->ID); ?>\" class=\"btn-edit\">\u270f\ufe0f Edit<\/a>\n                            <a href=\"<?php echo get_permalink($job->ID); ?>\" class=\"btn-view\" target=\"_blank\">\ud83d\udc41\ufe0f Preview<\/a>\n                            <button class=\"btn-delete\" onclick=\"deleteJob(<?php echo $job->ID; ?>)\">\ud83d\uddd1\ufe0f Delete<\/button>\n                        <\/div>\n                        \n                        <?php if (!empty($applications) && count($applications) > 0): ?>\n                            <div class=\"recent-applications\">\n                                <h5>Recent Applications:<\/h5>\n                                <div class=\"applicants-preview\">\n                                    <?php foreach (array_slice($applications, 0, 3) as $application): ?>\n                                        <?php\n                                        $developer_id = $application->developer_id;\n                                        $developer_name = jobmatch_get_display_name($developer_id, $user_id);\n                                        ?>\n                                        <div class=\"applicant-preview\">\n                                            <?php echo jobmatch_get_display_avatar($developer_id, $user_id, 'small'); ?>\n                                            <span class=\"applicant-name\"><?php echo esc_html($developer_name); ?><\/span>\n                                            <span class=\"application-status status-<?php echo $application->match_status; ?>\">\n                                                <?php\n                                                switch ($application->match_status) {\n                                                    case 'developer_liked':\n                                                        echo '\ud83d\udc99 Interested';\n                                                        break;\n                                                    case 'mutual':\n                                                        echo '\ud83d\udc9a Matched';\n                                                        break;\n                                                    case 'chatting':\n                                                        echo '\ud83d\udcac Chatting';\n                                                        break;\n                                                }\n                                                ?>\n                                            <\/span>\n                                        <\/div>\n                                    <?php endforeach; ?>\n                                    <?php if (count($applications) > 3): ?>\n                                        <span class=\"more-applicants\">+<?php echo count($applications) - 3; ?> more<\/span>\n                                    <?php endif; ?>\n                                <\/div>\n                            <\/div>\n                        <?php endif; ?>\n                    <\/div>\n                <?php endforeach; ?>\n            <\/div>\n        <?php else: ?>\n            <div class=\"no-jobs\">\n                <div class=\"empty-state-large\">\n                    <h3>\ud83d\udcdd No Jobs Posted Yet<\/h3>\n                    <p>Start attracting top talent by posting your first job opportunity.<\/p>\n                    <a href=\"<?php echo home_url('\/post-job\/'); ?>\" class=\"btn-primary-large\">Post Your First Job<\/a>\n                <\/div>\n            <\/div>\n        <?php endif; ?>\n    <\/div>\n    \n    <script>\n    function deleteJob(jobId) {\n        if (confirm('Are you sure you want to delete this job? This action cannot be undone.')) {\n            jQuery.post(ajaxurl, {\n                action: 'delete_job',\n                job_id: jobId,\n                nonce: jobmatch_nonce\n            }, function(response) {\n                if (response.success) {\n                    location.reload();\n                } else {\n                    alert('Error deleting job: ' + response.data);\n                }\n            });\n        }\n    }\n    <\/script>\n    <?php\n    return ob_get_clean();\n}\n\n\/\/ Render wallet management\nfunction jobmatch_render_wallet($user_id) {\n    $credit_balance = jobmatch_get_credit_balance($user_id);\n    $transactions = jobmatch_get_recent_transactions($user_id, 20);\n    \n    ob_start();\n    ?>\n    <div class=\"wallet-manager\">\n        <div class=\"wallet-header\">\n            <h2>\ud83d\udcb0 Credit Wallet<\/h2>\n            <div class=\"current-balance\">\n                <span class=\"balance-amount\"><?php echo $credit_balance; ?><\/span>\n                <span class=\"balance-label\">Credits Available<\/span>\n            <\/div>\n        <\/div>\n\n        <!-- Credit Packages -->\n        <div class=\"credit-packages\">\n            <h3>\ud83d\udce6 Buy Credit Packages<\/h3>\n            <div class=\"packages-grid\">\n                <?php\n                $packages = array(\n                    array('credits' => 10, 'price' => 29, 'popular' => false),\n                    array('credits' => 25, 'price' => 59, 'popular' => true),\n                    array('credits' => 50, 'price' => 99, 'popular' => false),\n                    array('credits' => 100, 'price' => 179, 'popular' => false)\n                );\n                \n                foreach ($packages as $package):\n                ?>\n                <div class=\"credit-package <?php echo $package['popular'] ? 'popular' : ''; ?>\">\n                    <?php if ($package['popular']): ?>\n                        <div class=\"popular-badge\">\ud83d\udd25 Most Popular<\/div>\n                    <?php endif; ?>\n                    <div class=\"package-credits\"><?php echo $package['credits']; ?> Credits<\/div>\n                    <div class=\"package-price\">\u20ac<?php echo $package['price']; ?><\/div>\n                    <div class=\"package-per-credit\">\u20ac<?php echo number_format($package['price'] \/ $package['credits'], 2); ?> per credit<\/div>\n                    <button class=\"btn-buy-package\" onclick=\"buyCredits(<?php echo $package['credits']; ?>, <?php echo $package['price']; ?>)\">\n                        Buy Now\n                    <\/button>\n                <\/div>\n                <?php endforeach; ?>\n            <\/div>\n            \n            <div class=\"payment-info\">\n                <p>\ud83d\udcb3 Secure payment powered by Stripe \u2022 \ud83d\udd12 SSL encrypted \u2022 \ud83d\udce7 Instant receipt<\/p>\n                <p>\ud83d\udca1 Credits are used when you get mutual matches with developers (1 credit per match)<\/p>\n            <\/div>\n        <\/div>\n\n        <!-- Transaction History -->\n        <div class=\"transaction-history\">\n            <h3>\ud83d\udcca Transaction History<\/h3>\n            <?php if (!empty($transactions)): ?>\n                <div class=\"transactions-table\">\n                    <div class=\"table-header\">\n                        <div class=\"col-date\">Date<\/div>\n                        <div class=\"col-description\">Description<\/div>\n                        <div class=\"col-amount\">Amount<\/div>\n                        <div class=\"col-balance\">Balance<\/div>\n                    <\/div>\n                    <?php foreach ($transactions as $transaction): ?>\n                        <div class=\"transaction-row\">\n                            <div class=\"col-date\"><?php echo date('M j, Y', strtotime($transaction->created_at)); ?><\/div>\n                            <div class=\"col-description\"><?php echo esc_html($transaction->description); ?><\/div>\n                            <div class=\"col-amount <?php echo $transaction->amount > 0 ? 'positive' : 'negative'; ?>\">\n                                <?php echo $transaction->amount > 0 ? '+' : ''; ?><?php echo $transaction->amount; ?>\n                            <\/div>\n                            <div class=\"col-balance\"><?php echo $transaction->balance_after; ?><\/div>\n                        <\/div>\n                    <?php endforeach; ?>\n                <\/div>\n            <?php else: ?>\n                <p class=\"empty-state\">No transactions yet.<\/p>\n            <?php endif; ?>\n        <\/div>\n    <\/div>\n    \n    <script>\n    function buyCredits(credits, price) {\n        if (confirm(`Purchase ${credits} credits for \u20ac${price}?`)) {\n            jQuery.post(ajaxurl, {\n                action: 'create_stripe_checkout',\n                credits: credits,\n                price: price,\n                nonce: jobmatch_nonce\n            }, function(response) {\n                if (response.success) {\n                    window.location.href = response.data.checkout_url;\n                } else {\n                    alert('Error: ' + response.data);\n                }\n            });\n        }\n    }\n    <\/script>\n    <?php\n    return ob_get_clean();\n}\n\n\/\/ Placeholder for profile editor (implement as needed)\nfunction jobmatch_render_company_profile_editor($user_id) {\n    return '<div class=\"profile-editor\">Company profile editor will be implemented here.<\/div>';\n}\n\n\/\/ Placeholder for messages (implement as needed)\nfunction jobmatch_render_messages($user_id) {\n    return '<div class=\"messages\">Messaging system will be implemented here.<\/div>';\n}\n\n\/\/ AJAX handler for job deletion\nadd_action('wp_ajax_delete_job', 'jobmatch_ajax_delete_job');\n\nfunction jobmatch_ajax_delete_job() {\n    check_ajax_referer('jobmatch_nonce', 'nonce');\n    \n    $job_id = intval($_POST['job_id']);\n    $current_user_id = get_current_user_id();\n    \n    \/\/ Security check - ensure user owns the job\n    $job = get_post($job_id);\n    if (!$job || $job->post_author != $current_user_id || $job->post_type !== 'jobs') {\n        wp_send_json_error('Unauthorized');\n    }\n    \n    \/\/ Delete the job\n    $result = wp_delete_post($job_id, true);\n    \n    if ($result) {\n        wp_send_json_success('Job deleted successfully');\n    } else {\n        wp_send_json_error('Failed to delete job');\n    }\n}\n\n\/\/ Add company dashboard styles\nadd_action('wp_enqueue_scripts', 'jobmatch_enqueue_company_dashboard_assets');\n\nfunction jobmatch_enqueue_company_dashboard_assets() {\n    if (is_page() && has_shortcode(get_post()->post_content, 'company_dashboard')) {\n        wp_enqueue_script('jquery');\n        \n        \/\/ Add nonce for AJAX calls\n        wp_localize_script('jquery', 'jobmatch_ajax', array(\n            'ajax_url' => admin_url('admin-ajax.php'),\n            'nonce' => wp_create_nonce('jobmatch_nonce')\n        ));\n        \n        \/\/ Add company dashboard specific styles\n        wp_add_inline_style('wp-block-library', jobmatch_get_company_dashboard_styles());\n    }\n}\n\n\/\/ Company dashboard specific styles (continued in the original file)","active":true,"modified":"2025-09-24 16:08:51","revision":"1"}]}